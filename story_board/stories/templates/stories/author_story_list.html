{% extends "stories/story_list.html" %}
{% load static from staticfiles %}

{% block static %}
{{ block.super }}
    <link href="{% static 'stories/css/author_story_list.css' %}" rel="stylesheet" type="text/css" media="all">
{% endblock static%}


{% block page_header %}
  <div class="card text-center">
    <div class="card-header">
      Author Story Board
    </div>
    <div class="card-body">
      <h5 class="card-title">{{ author }}</h5>
      <p class="card-text" hidden>With supporting text below as a natural lead-in to additional content.</p>
      <a href="#" class="btn btn-primary" hidden>Go somewhere</a>
    </div>
    <div class="card-footer text-muted">
      Joined: {{ author.user.date_joined }}
    </div>
  </div>
{% endblock page_header %}


{% block page_button %}
  {% if user.is_authenticated %}
    {% if user == author.user %}
      {{ block.super }}
    {% else %}
      {% if guest_author.user in author.followers.all %}
        <form method="POST" class="row float-right">
        {% csrf_token %}
          <input name="unfollow" type="submit" value="Unfollow" class="btn-small btn-primary mt-5 mr-2 mr-md-0">
        </form>
      {% else %}
        <form method="POST" class="row float-right">
        {% csrf_token %}
          <input name="follow" type="submit" value="Follow" class="btn-small btn-primary mt-5 mr-2 mr-md-0">
        </form>
      {% endif %}
    {% endif %}
  {% endif %}
{% endblock page_button %}

{% block section_after_story_list %}
<div id="draft_stories" class="col-sm-12 col-md-5 col-lg-4 col-xl-3">
            <!-- Bootstrap card start-->
      {% for story in draft_stories %}
      
      <div class="m-1">
        <div class="card rounded" style="width: 15rem;">
          <!-- <img class="card-img-top" src="..." alt="Card image cap"> -->
          <div class="card-body">

            <!-- Card body start -->
            <h4 class="card-title"> 
              <a id="a_story_title" class="font-italic" data-toggle="modal" data-target="#exampleModalLong_{{ story.id }}" style="cursor: pointer;"> 
                {{ story.title }} 
              </a> 
            </h4>

            {% if story.author %}
            <h6 class="card-subtitle mb-2 text-muted">By: <a id="a_story_author" href="{% url 'stories:author_story_list' story.author %}">{{ story.author }}</a>
            </h6>
            {% else %}
            <h6 class="card-subtitle mb-2 text-muted">By: Anonymous
            </h6>
            {% endif %}
            
            <p class="card-text mb-0"> 
              {{ story.body|truncatechars:200 }}
               <!-- Button trigger modal start -->
                <!-- <a class="text-primary font-italic float-right" data-toggle="modal" data-target="#exampleModalLong_{{ story.id }}" style="cursor: pointer;"> <small> View </small> </a> -->
              <!-- Button trigger modal end -->
            </p>
            <!-- Card body end -->
            
            <div class="row pt-2">
              <div class="col-sm">
                <p class="text-center mb-0 pb-0">{{ story.recommendations.count }}</p>
                <p class="text-center mb-0 pb-0"><small> Recommendations </small></p>
              </div>
              <div class="col-sm">
                {% if user.is_authenticated %}
                  {% if user == guest_author.user and user != story.author.user %}
                    {% if guest_author in story.recommendations.all %}
                    <form method="POST" class="btn btn-sm">
                    {% csrf_token %}
                      <button class="btn btn-secondary btn-sm" data-toggle="tooltip" data-placement="top" title="Unrecommend">
                      Unrec
                        <input name="unrecommend" type="hidden" value="{{story.id}}" class="btn btn-sm">
                      </button>
                    </form>
                    {% else %}
                    <form method="POST" class="btn btn-sm">
                    {% csrf_token %}
                      <button class="btn btn-secondary btn-sm" data-toggle="tooltip" data-placement="top" title="Recommend">
                      Rec
                        <input name="recommend" type="hidden" value="{{story.id}}" class="btn btn-sm">
                      </button>
                    </form>
                    {% endif %}
                  {% endif %}

                  {% if user == story.author.user %}
                    <form method="POST" class="btn btn-sm">
                    {% csrf_token %}
                      <button class="btn btn-secondary btn-sm" data-toggle="tooltip" data-placement="top" title="Recommend">
                      Recall
                        <input name="recall" type="hidden" value="{{story.id}}" class="btn btn-sm">
                      </button>
                    </form>
                  {% endif %}

                {%endif %}
              </div>
            </div>

            <!-- Modal start -->
            <div class="modal fade" id="exampleModalLong_{{ story.id }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle_{{ story.id }}" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle_{{ story.id }}"> {{ story.title }} </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    {{ story.body }}
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>
            <!-- Modal end -->

          </div>
        </div>
      </div>
    {% endfor %}
    <!-- Bootstrap card end-->

</div>
{% endblock section_after_story_list %}